# trivy-vulnerability-exporter

A Prometheus Exporter that collects all vulnerabilities detected by aquasecurity/trivy in kubernetes clusters.

Inspirated by [kube-trivy-expoter](https://github.com/kaidotdev/kube-trivy-exporter).

This exporter is written on top of [cobra library](https://github.com/spf13/cobra) and [trivy cli](https://github.com/aquasecurity/trivy).

## Grafana dashboards

- Download grafana dashboard [here](assets/grafana_dashboard.json)

<p align="center">
  <img src="assets/trivy_dashboard.png"/>
</p>

## Requirements

- Kubernetes cluster
- Install the exporter using helm to setup the RBAC
- Prometheus
- Grafana

## Install the exporter

- Access the helm repository [here](https://lucasafonsokremer.github.io/helm-trivy-vulnerability-exporter/) for more details abount installation process.

### Add trivy vulnerability exporter repository

```bash
helm repo add helm-trivy-vulnerability-exporter https://lucasafonsokremer.github.io/helm-trivy-vulnerability-exporter
```

### Install trivy vulnerability exporter chart

```bash
helm upgrade -i trivyvulnerabilityexporter helm-trivy-vulnerability-exporter/trivyvulnerabilityexporter
```

### Install trivy vulnerability exporter chart with custom values

```bash
helm upgrade -i trivyvulnerabilityexporter helm-trivy-vulnerability-exporter/trivyvulnerabilityexporter -f values-custom.yaml
```

## Image Scan

Image Scan scans for vulnerabilities in container images of workloads deployed in kubernetes.

```bash
trivy_image_vulnerabilities
```

## Node Scan

Image Scan scans vulnerabilities of the nodes of kuberntes cluster.

```bash
trivy_node_vulnerabilities
```

## Development Environment

- You could upgrade trivy version on the Dockerfile:

```
ENV TRIVYVERSION=v0.22.0
```

- After that, import the new trivy library:

```
go get github.com/aquasecurity/trivy@v0.22.0
go mod tidy
```


## ToDo

- Create a makefile for development environment
- Improve the unit tests
